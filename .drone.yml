---
kind: pipeline
type: docker
name: default

steps:
  - name: lint
    image: golangci/golangci-lint
    pull: if-not-exists
    commands:
      - golangci-lint run

  - name: test
    image: golang:1.18
    pull: if-not-exists
    commands:
      - go clean -testcache
      - go test ./... -v

  - name: build
    image: goreleaser/goreleaser
    pull: if-not-exists
    commands:
<<<<<<< HEAD
      - goreleaser build --snapshot --rm-dist --debug
  
  - name: push image to registry
=======
      - goreleaser build --snapshot --rm-dist

  - name: push
>>>>>>> fa58079 (simplify multi arch build)
    image: thegeeklab/drone-docker-buildx
    privileged: true
    pull: if-not-exists
    settings:
      platforms:
        - linux/amd64
        - linux/arm64
      context: dist

services:
<<<<<<< HEAD
  - name: mongodb
    image: mongo

      
=======
  # Default database for testing
  - name: postgresql
    image: postgres:14.4-alpine
    environment:
      POSTGRES_PORT: 5432
      POSTGRES_PASSWORD: pa55Word!
      POSTGRES_USER: demo
      POSTGRES_DB: demodb
  # If you are using mysql/mariadb, uncomment this
  # - name: mysql
  #   image: mariadb
  #   environment:
  #     MYSQL_PORT: 3306
  #     MYSQL_ROOT_PASSWORD: superS3cret!
  #     MYSQL_PASSWORD: pa55Word!
  #     MYSQL_USER: demo
  #     MYSQL_DATABASE: demodb
>>>>>>> fa58079 (simplify multi arch build)
